## 使用蓝图 根路由/home

### 文件说明：
* ./\__init__.py  蓝图设置
* ./marketing.py  查询数据库等实现部分
* ./index.py 子路由设置

### 访问网址
47.94.133.35:6600

------------------------------------------------
* /marketing/add_active 添加活动（post）
* 参数
> {	
	"active_no": "13214323",           -- 活动编号
	"active_name": "测试测试测试",       -- 活动标题
	"order_show_name": "订单名称",      -- 在订单显示的名称
	"trolley_show_name": "购物车名称",   -- 在购物车的名称
	"start_time": "2019-12-19 00:00:00",  -- 开始时间
	"end_time":"2020-02-19 00:00:00",     -- 结束时间
	"threshold_type": "元",            -- 满减的单位（元/罐）
	"threshold_num": 500,              -- 满减的阈值
	"discount_type": "折扣",           -- 折扣的方式（折扣/金额）
	"discount_num": 5,                -- 折扣的金额或百分比
	"max_money": 5000                 -- 最大优惠金额
	"goods_list": ["0000001","0000002","0000003","0000005","0000007","0000011"],   -- 商品id 的列表
	"label_id": [2, "all"],         -- 用户标签的id列表
	"user_list": ["WFH63391692","WFH45369911","WFH22322675","WFH25531052","WFH83632319"] -- user_id
  "user_type": ["1级用户", "2级用户", "3级用户", "4级用户", "5级用户", "普通用户", "企业用户", "all"]
}

* 返回值
> {
  "data": true,
  "message": "ok"
}
---------------------------------------------
* /marketing/get_active_list  获取活动列表（get）

* 参数
> page_count=1    -- 每页的数量
> current_page=1  -- 当前页

* 返回值
> {
  "data": {
    "count": 2,                   -- 总数量
    "data_list": [
      {
        "active_id": 2,          -- 活动的id
        "active_name": "测试测试测试",   -- 活动的名称
        "active_no": "13214323",      -- 活动的编号
        "discount_num": 5.0,          -- 折扣的百分比或价格
        "discount_type": "折扣",       -- 折扣的方式（折扣/金额）
        "end_time": "2020-02-19 00:00:00",   -- 结束时间
        "start_time": "2019-12-19 00:00:00",  -- 开始时间
        "state": "进行中",                 -- 活动状态
        "threshold_num": 500,             -- 活动的阈值
        "threshold_type": "元"            -- 活动阈值类型（元/罐）
      }
    ]
  },
  "message": "ok"
}
--------------------------------------------------
* /marketing/get_active_detail  获取活动详情（get）

* 参数
> active_id=2    -- 活动的id

* 返回值
> {
  "data": {
    "active_name": "测试测试测试",    -- 活动名称
    "active_no": "13214323",        -- 活动编号
    "discount_num": 5.0,            -- 优惠的金额
    "discount_type": "金额",        -- 优惠的类型（金额/折扣）
    "end_time": "2020-02-19 00:00:00",    -- 结束时间
    "goods_list": [          -- 商品id列表
      "0000003",
      "0000002",
      "0000001",
      "0000007",
      "0000011",
      "0000005"
    ],
    "order_show_name": "订单名称",          -- 订单中显示的名称
    "start_time": "2020-02-19 00:00:00",  -- 开始时间
    "threshold_num": 500,                -- 优惠的阈值
    "threshold_type": "元",              -- 优惠的类型
    "trolley_show_name": "购物车名称",     -- 在购物车的名称
    "user_label_id": 2,                 -- 用户的标签id
    "user_list": [                    -- 用户的列表
      "WFH83632319",
      "WFH25531052",
      "WFH45369911",
      "WFH63391692",
      "WFH20794424",
      "WFH49939757",
      "WFH22322675",
      "WFH52753343",
      "WFH77403989"
    ]
  },
  "message": "ok"
}

-------------------------------------------------
* /marketing/update_active 更改活动（post）

* 参数
> {	
    "active_id": 2                   -- 活动id
	"active_no": "13214323",           -- 活动编号
	"active_name": "测试测试测试",       -- 活动标题
	"order_show_name": "订单名称",      -- 在订单显示的名称
	"trolley_show_name": "购物车名称",   -- 在购物车的名称
	"start_time": "2019-12-19 00:00:00",  -- 开始时间
	"end_time":"2020-02-19 00:00:00",     -- 结束时间
	"threshold_type": "元",            -- 满减的单位（元/罐）
	"threshold_num": 500,              -- 满减的阈值
	"discount_type": "折扣",           -- 折扣的方式（折扣/金额）
	"discount_num": 5,                -- 折扣的金额或百分比
	"goods_list": ["0000001","0000002","0000003","0000005","0000007","0000011"],   -- 商品id 的列表
	"label_id": 2,         -- 用户标签的id
	"user_list": ["WFH63391692","WFH45369911","WFH22322675","WFH25531052","WFH83632319"] -- user_id
}

---------------------------------------
* /marketing/delete_active  删除活动（post）

* 参数
> {
	"active_id": "2,3"    -- 活动的id(多个id使用英文,间隔)
}
* 返回值
> {
  "data": true,
  "message": "ok"
}

## 优惠券的接口
------------------------------------------
* /marketing/add_coupon 添加优惠券（post）

* 参数
> {	
	"coupon_type": "普通",                  -- 优惠券类型(普通/新手)
	"coupon_no": "13214323",               -- 优惠券编号
	"coupon_name": "测试测试测试",            -- 优惠券名称
	"order_show_name": "订单名称",           -- 在订单中显示的名称
	"trolley_show_name": "购物车名称",       -- 在购物车中的名称
	"start_time": "2019-12-19 00:00:00",   -- 开始时间
	"end_time":"2020-02-19 00:00:00",      -- 结束时间
	"threshold_type": "罐",                -- 优惠阈值(元/罐）
	"threshold_num": 5,                    -- 优惠的阈值
	"discount_type": "折扣",                -- 优惠的类型（折扣/金额）
	"discount_num": 5,                     -- 优惠的数值
	"goods_list": ["0000001","0000002","0000003","0000005","0000007","0000011"],  -- 优惠的商品id列表
	"label_id": 2,                         -- 用户的标签id
	"coupon_num": 10,                      -- 每个人发放的数量 不限，传入9999  (基本不会使用到这个数量就像但由于不限了)
	"user_list": ["WFH63391692","WFH45369911","WFH22322675","WFH52753343","WFH20794424"]  -- 发放优惠券的用户的id
}

* 返回值
> {
  "data": true,
  "message": "ok"
}

-------------------------------------------------------------
* /marketing/get_coupon_list 获取商品列表

* 参数
> page_count=1    -- 每页的数量
> current_page=1  -- 当前页

* 返回值
> {
  "new": {                  -- 新用户优惠券
    "count": 1,
    "data_list": [
      {
        "coupon_id": 4,               -- 优惠券id
        "coupon_name": "测试测试测试",  -- 优惠券名称
        "coupon_no": "13214323",     -- 优惠券编号
        "coupon_num": 10,            -- 优惠券发放数量
        "discount_num": 5.0,         -- 优惠的金额/百分比
        "discount_type": "折扣",      -- 优惠形式（折扣/金额）
        "end_time": "2020-02-19 00:00:00",  -- 结束时间
        "is_close": 0,               -- 是否关闭（1/关闭  0/未关闭）
        "start_time": "2019-12-19 00:00:00",    -- 开始时间
        "state": "进行中",             -- 状态
        "threshold_num": 5,           -- 优惠券使用的阈值
        "threshold_type": "罐"        -- 优惠券阈值单位
      }
    ]
  },
  "ordinary": {                  -- 普通优惠券的列表
    "count": 2,
    "data_list": [
      {
        "coupon_id": 1,
        "coupon_name": "测试测试测试",
        "coupon_no": "13214323",
        "coupon_num": 2,
        "discount_num": 5.0,
        "discount_type": "折扣",
        "end_time": "2020-02-19 00:00:00",
        "is_close": 0,
        "start_time": "2019-12-19 00:00:00",
        "state": "进行中",
        "threshold_num": 5,
        "threshold_type": "罐"
      },
      {
        "coupon_id": 2,
        "coupon_name": "测试测试测试",
        "coupon_no": "13214323",
        "coupon_num": 2,
        "discount_num": 5.0,
        "discount_type": "折扣",
        "end_time": "2020-02-19 00:00:00",
        "is_close": 0,
        "start_time": "2019-12-19 00:00:00",
        "state": "进行中",
        "threshold_num": 5,
        "threshold_type": "罐"
      }
    ]
  }
}

-----------------------------------------------------
*  /marketing/get_coupon_detail  获取优惠券的详情

* 参数
> coupon_id=4    -- 优惠券的id

* 返回值
> {
  "data": {
    "coupon_name": "测试测试测试",    -- 优惠券名称
    "coupon_no": "13214323",        -- 优惠券编号
    "coupon_num": 10,              -- 优惠券发放数量
    "discount_num": 5.0,           -- 优惠金额/百分比
    "discount_type": "折扣",        -- 优惠类型
    "end_time": "2020-02-19 00:00:00",   -- 结束时间
    "goods_list": [                -- 商品的id 列表
      "0000003",
      "0000011",
      "0000002",
      "0000001",
      "0000007",
      "0000005"
    ],
    "is_close": 0,                    -- 是否关闭
    "order_show_name": "订单名称",      -- 订单中显示的名称
    "start_time": "2019-02-19 00:00:00",  -- 开始时间
    "threshold_num": 5,                -- 阈值数量
    "threshold_type": "罐",            -- 阈值单位（元/罐）
    "trolley_show_name": "购物车名称",   -- 购物车名称
    "user_label_id": 2,                -- 用户标签id
    "user_list": []                    -- 享有优惠券用户的id列表
  },
  "message": ""
}


-------------------------------------------------------------------
* 更新(post)
* 参数
> {	
	"coupon_id": 4,                      -- 新加必传优惠券的id
	"coupon_type": "新手",
	"coupon_no": "13214323",
	"coupon_name": "测试测试测试",
	"order_show_name": "订单名称",
	"trolley_show_name": "购物车名称",
	"start_time": "2019-12-19 00:00:00",
	"end_time":"2020-02-19 00:00:00",
	"threshold_type": "罐",
	"threshold_num": 5,
	"discount_type": "金额",
	"discount_num": 50,
	"goods_list": ["0000001","0000002","0000003","0000005","0000007","0000011"],
	"label_id": 2,
	"coupon_num": 10
}

* 返回值
> {
  "data": true,
  "message": "ok"
}
-----------------------------------------------
* /marketing/delete_coupon 删除优惠券(post)

* 参数
> {
	"coupon_id": "2,3"    -- 优惠券的id 多个使用英文, 间隔
}

* 返回值
> {
  "data": true,
  "message": "ok"
}
----------------------------------------------
* /marketing/close_coupon 关闭优惠券(post)

* 参数
> {
	"coupon_id": "2,3"    -- 优惠券的id 多个使用英文, 间隔
}

* 返回值
> {
  "data": true,
  "message": "ok"
}
------------------------------------------------------
* /marketing/discounts_info  最上的数量信息

* 参数 
> 无

* 返回值
> {
  "data": {
    "active": 0.0,     -- 通过活动总返利
    "coupon": 0.0      -- 通过优惠券总返利
  },
  "message": "ok"
}

## 辅助就接口
====================================================================

* /marketing/goods_list  获取商品信息  

* 参数
> search=哈                       -- 搜索(标题/商品编号)
> goods_id=000002,000003,000004  -- 根据商品id 批量获取(更新时反查显示)
> page_count                     -- (选填) 每页数量 
> current_page                   -- （选填）当前页|——-> 一起使用才有效
* 返回值
> {
  "data": {
    "count": 0,
    "data_list": [
      {
        "goods_id": "000004",
        "pic_link": "/pic/goods/9a95db2badcfa8ab7939b9da2436046b.png",
        "title": "哇哈哈"
      },
      {
        "goods_id": "000003",
        "pic_link": "/pic/goods/9a95db2badcfa8ab7939b9da2436046b.png",
        "title": "哇哈哈"
      },
      {
        "goods_id": "000002",
        "pic_link": "/pic/goods/9a95db2badcfa8ab7939b9da2436046b.png",
        "title": "哇哈哈"
      }
    ]
  },
  "message": "ok"
}

---------------------------------------------------
* /marketing/user_list  获取用户列表

* 参数
> search=哈                       -- 搜索(标题/商品编号)
> user_id=WFH59768597,WFH46241190,WFH70312768  -- 根据商品id 批量获取(更新时反查显示)
> label_id=1                     -- 标签id
> page_count                     -- (选填) 每页数量 
> current_page                   -- （选填）当前页|——-> 一起使用才有效
* 返回值
> {
  "data": {
    "count": 3,
    "data_list": [
      {
        "nickname": "really",     -- 昵称
        "user_id": "WFH46241190"  -- user_id
      },
      {
        "nickname": "likamoer",
        "user_id": "WFH70312768"
      }
    ]
  },
  "message": "ok"
}

## 消息通知
----------------------------------------------------------------
* 获取消息通知的标题列表  /marketing/module_list

* 必选参数
> type  类型: weixin/sms  

* 返回值
> {
  "data": [
    {
      "sms_id": 16,
      "title": "邀请结果通知"
    },
    {
      "sms_id": 17,
      "title": "提现审核结果通知"
    },
    {
      "sms_id": 18,
      "title": "退款通知"
    },
    {
      "sms_id": 19,
      "title": "积分兑换成功通知"
    },
    {
      "sms_id": 20,
      "title": "退款成功通知"
    },
    {
      "sms_id": 21,
      "title": "优惠券到账提醒"
    },
    {
      "sms_id": 22,
      "title": "订阅活动开始提醒"
    },
    {
      "sms_id": 23,
      "title": "订单发货通知"
    }
  ],
  "message": "ok"
}

--------------------------------

* 获取消息通知的详情  /marketing/module_detail
* 必传参数
> sms_id   

* 返回值
> {
  "data": {
    "content_field": "{\"name\": \"str\"}",                 -- 模板消息的替换字段
    "is_close": 1,                                          -- 是否关闭
    "module_code": "SMS_173473166",                         -- 模板的第三方唯一码
    "module_content": "尊敬的${name}，您的宝贝已经在购物车中等待许久，别忘了把它们带回家哦！",    -- 消息的内容*(微信的内容是一个图片)
    "module_title": "购物车未购买提醒",                        -- 模板消息标题
    "sms_id": 1                                             -- id
  },
  "message": "ok"
}

-------------------------------------------------------
修改模板消息的开关   /marketing/update_module  （post）

* 请求体
> {
	"sms_id": 1,
	"is_close": 1        -- 是否关闭 (0，1)
}

* 返回值
> {
  "data": true,
  "message": "ok"
}